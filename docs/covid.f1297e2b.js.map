{"version":3,"sources":["javasript/covid.js"],"names":["options","config","init","view","tooltip","vegaTooltip","Handler","call","renderer","vl","register","vega","vegaLite","url","dataArray","stateArray","d3","csv","then","data","forEach","d","parseDate","utcParse","date","state","cases","deaths","push","includes","sort","drawLineVegaLite","layer1","plot","width","height","title","layer2","vconcat","spacing","render","viewElement","document","getElementById","appendChild","selection","selectSingle","fields","bind","menu","name","hover","on","clear","nearest","empty","label","align","dx","dy","white","stroke","strokeWidth","markLine","color","select","transform","filter","encode","y","fieldQ","casetip","markRule","opacity","if","value","fieldT","casepoints","markCircle","size","case_text","markText","text","layer","x","death","deathTip","death_points","death_text"],"mappings":"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","file":"covid.f1297e2b.js","sourceRoot":"..\\src","sourcesContent":["import casedata from '../../static/us-states.csv'    // import dataset\r\n\"use strict\";     // the code should be executed in \"strict mode\".\r\n                  // With strict mode, you can not, for example, use undeclared variables\r\n\r\n\r\nconst options = {\r\n  config: {\r\n    // Vega-Lite default configuration\r\n  },\r\n  init: (view) => {\r\n    // initialize tooltip handler\r\n    view.tooltip(new vegaTooltip.Handler().call);\r\n  },\r\n  view: {\r\n    // view constructor options\r\n    // remove the loader if you don't want to default to vega-datasets!\r\n    //   loader: vega.loader({\r\n    //     baseURL: \"\",\r\n    //   }),\r\n    renderer: \"canvas\",\r\n  },\r\n};\r\n\r\nvl.register(vega, vegaLite, options);\r\nvar url = \"https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv\";\r\nvar dataArray = [];\r\nvar stateArray = [];\r\n\r\nd3.csv(url).then(function(data) {\r\n  data.forEach(function(d){\r\n    const parseDate = d3.utcParse(\"%Y-%m-%d\");\r\n    var date = parseDate(d.date);\r\n    var state = d.state;\r\n    var cases = +d.cases;\r\n    var deaths = +d.deaths;\r\n    dataArray.push({date: date, state: state, cases: cases, deaths: deaths})\r\n    if (!stateArray.includes(state)) {\r\n      stateArray.push(state)\r\n    }\r\n    stateArray = stateArray.sort();\r\n  })\r\n  drawLineVegaLite();\r\n});\r\n\r\nfunction drawLineVegaLite() {\r\n  const layer1 = plot('cases')\r\n    .width(600)\r\n    .height(225)\r\n    .title(\"Cumulative Covid-19 Case Counts\");\r\n\r\n  const layer2 = plot('deaths')\r\n    .width(600)\r\n    .height(225)\r\n    .title(\"Cumulative Covid-19 Death Counts\");\r\n\r\n  return vl.vconcat(layer1, layer2).spacing(5)\r\n    .render()\r\n    .then(viewElement => {\r\n      // render returns a promise to a DOM element containing the chart\r\n      // viewElement.value contains the Vega View object instance\r\n      document.getElementById('covid-data').appendChild(viewElement);\r\n    });\r\n}\r\n\r\n/*\r\nfunction plot(field) {\r\n  const selection = vl.selectSingle('Select')\r\n    .fields('state')\r\n    .init({'state': 'Washington'})\r\n    .bind(vl.menu(stateArray).name('State: '))\r\n\r\n  const hover = vl.selectSingle()\r\n    .fields('date')\r\n    .on('mouseover') // select on mouseover\r\n    .clear('mouseout')\r\n    .nearest(true)   // select nearest point to mouse cursor\r\n    .empty(\"none\")\r\n\r\n  //const label = {align: 'left', dx: 5, dy: -5};\r\n\r\n  const line = vl.markLine({color: '#F6573F'})\r\n    .select(selection)\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.y().fieldQ(field),\r\n    )\r\n    \r\n  const tip = vl.markRule({color: \"#aaa\"})\r\n    .select(hover)\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.opacity().if(hover, vl.value(1)).value(0),\r\n      vl.tooltip([vl.fieldT('date'), vl.fieldQ(field)])\r\n    );\r\n\r\n  const point = vl.markCircle({size: 30})\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.y().fieldQ(field),\r\n      vl.opacity().if(hover, vl.value(1)).value(0)\r\n    );\r\n\r\n  return vl.layer(line, tip, point)\r\n    .data(dataArray)\r\n    .encode(\r\n      vl.x({title: 'Date'}).fieldT('date')\r\n    );\r\n}\r\n*/\r\n\r\n//stateArray = stateArray.sort();\r\n\r\nfunction drawLineVegaLite() {\r\n\r\n  const selection = vl.selectSingle('Select')\r\n    .fields('state')\r\n    //.init({'state': stateArray[0]})\r\n    .init({'state': 'Washington'})\r\n    .bind(vl.menu(stateArray).name('State: '))\r\n\r\n  const hover = vl.selectSingle()\r\n    .fields('date')\r\n    .on('mouseover') // select on mouseover\r\n    .clear('mouseout')\r\n    .nearest(true)   // select nearest point to mouse cursor\r\n    .empty(\"none\")\r\n\r\n  const label = {align: 'left', dx: 5, dy: -5};\r\n  const white = {stroke: 'white', strokeWidth: 2};\r\n    \r\n  const cases = vl.markLine({color: '#F6573F'})\r\n    .select(selection)\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.y({title: 'Cases'}).fieldQ('cases'),\r\n    )\r\n    .width(600)\r\n    .height(225)\r\n    .title(\"Cumulative Covid-19 Case Counts\");\r\n \r\n  const casetip = vl.markRule({color: \"#aaa\"})\r\n    .select(hover)\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.opacity().if(hover, vl.value(1)).value(0),\r\n      vl.tooltip().fieldT('date')\r\n    );\r\n\r\n  const casepoints = vl.markCircle({size: 30})\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.y().fieldQ('cases'),\r\n      vl.opacity().if(hover, vl.value(1)).value(0)\r\n    );\r\n\r\n  const case_text = vl.markText(label)\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.y().fieldQ('cases'),\r\n      vl.opacity().if(hover, vl.value(1)).value(0),\r\n      vl.text().fieldQ('cases')\r\n    )\r\n    \r\n  const layer1 = vl.layer(cases, casetip, casepoints, case_text)\r\n    .data(dataArray)\r\n    .encode(\r\n      vl.x({title: 'Date'}).fieldT('date')\r\n    );\r\n\r\n  const death = vl.markLine({color: '#F6573F'})\r\n    .select(selection)\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.y({title: 'Deaths'}).fieldQ('deaths'),\r\n    )\r\n    .width(600)\r\n    .height(225)\r\n    .title(\"Cumulative Covid-19 Death Counts\");\r\n \r\n  const deathTip = vl.markRule({color: \"#aaa\"})\r\n    .select(hover)\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.opacity().if(hover, vl.value(1)).value(0),\r\n      vl.tooltip().fieldT('date')\r\n    );\r\n\r\n  const death_points = vl.markCircle({size: 30})\r\n    .transform(\r\n      vl.filter(selection)\r\n    )\r\n    .encode(\r\n      vl.y().fieldQ('deaths'),\r\n      vl.opacity().if(hover, vl.value(1)).value(0)\r\n    );\r\n    \r\n  const death_text = vl.markText(label)\r\n      .transform(\r\n        vl.filter(selection)\r\n      )\r\n      .encode(\r\n        vl.y().fieldQ('deaths'),\r\n        vl.opacity().if(hover, vl.value(1)).value(0),\r\n        vl.text().fieldQ('deaths')\r\n      )\r\n\r\n  const layer2 = vl.layer(death, deathTip, death_points, death_text)\r\n    .data(dataArray)\r\n    .encode(\r\n      vl.x({title: 'Date'}).fieldT('date')\r\n    );\r\n    \r\n  return vl.vconcat(layer1, layer2).spacing(5)\r\n    .render()\r\n    .then(viewElement => {\r\n      // render returns a promise to a DOM element containing the chart\r\n      // viewElement.value contains the Vega View object instance\r\n      document.getElementById('covid-data').appendChild(viewElement);\r\n    });\r\n}\r\n\r\n\r\n\r\n"]}